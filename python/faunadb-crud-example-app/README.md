# FaunaDB CRUD REST Service Example

This is an example application which showcases how to create a simple CRUD REST service backed by FaunaDB. The examples presented in the [Getting Started](https://app.fauna.com/documentation/gettingstarted) and [CRUD](https://app.fauna.com/documentation/howto/crud) guides have been used as starting point for its implementation.

__Table of Contents__

* [Prerequisites](#prerequisites)
* [Running the app](#running-the-app)
* [API Reference](#api-reference)
  * [Create a Post](#create-a-post)
  * [Create several Posts](#create-several-posts)
  * [Retrieve a Post](#retrieve-a-post)
  * [Retrieve Posts](#retrieve-posts)
  * [Retrieve Posts by Tags](#retrieve-posts-by-tags)
  * [Replace a Post](#replace-a-post)
  * [Delete a Post](#delete-a-post)

## Prerequisites

### 1. Setup a Fauna Cloud account
Create a Fauna Cloud account filling the form [here](https://app.fauna.com/sign-up).


### 2. Install Fauna Shell
Open a terminal and install the Fauna Shell.  If you are on a PC, you can use [npm](https://www.npmjs.com/get-npm):

```
$ npm install -g fauna-shell
```

Alternatively, if you are on a Mac, you can use [Homebrew](https://brew.sh/):

```
$ brew install fauna-shell
```


### 3. Create Database
Next, create a new database to which the application will connect to for storing the data. For doing so, login to your Fauna Cloud account from the Fauna Shell by typing the following command:

```
$ fauna cloud-login
```

It will prompt for your Fauna Cloud credentials, where you need to enter the email you used for signing up, and your password.

```
Email: email@example.com
Password: **********
```

> Note: once you are logged in on a machine, the Fauna Shell will remember your credentials so you donâ€™t need to log in again.

The next step will be to create the database. Issue the following command for creating a database called `demo-app`:


```
$ fauna create-database demo-app
```


### 4. Set up Schema

Run below command for creating the DB schema. It will execute all required queries from a file.

```
$ fauna run-queries demo-app --file=./scripts/create_schema.fql
```

### 5. Obtain an API Key
Next, issue an API Key for connecting to the new created DB from the service. Execute below command for doing so:

```
$ fauna create-key demo-app server
```

Make sure to write down the given secret key. It will be used for starting up the service later on.

> Alternatively, you can also create an API Key from the Cloud Dashboard [here](https://dashboard.fauna.com/db/demo-app/keys).

## Install Python Requirements

```
$ pip install -r requirements.txt
```

## Running the app

For starting up the service, execute below command making sure to include a proper API key as follows:

```
$ FAUNA_KEY=your_api_key_goes_here python main.py
```

The app will start at port `8080`.  You can adjust this at the bottom of `main.py` if needed.

## API Reference

### Create a Post
Creates a new Post with an autogenerated Id.

#### Request

```
POST /posts
```

```
Content-type: application/json
{
  "title": "My cat and other marvels",
  "tags": ["pet", "cute"]
}
```

##### curl example

```
$ curl -POST -H "Content-type: application/json" -d '{
  "title": "My cat and other marvels",
  "tags": ["pet", "cute"]
}' 'http://localhost:8080/posts'
```

#### Response

```
Status: 201 - Created
```
```
Content-type: application/json
{
  "id": "219871526709625348",
  "title": "My cat and other marvels",
  "tags": ["pet", "cute"]
}
```

### Create several Posts
Creates several Posts within a single requests. The Posts will be persisted in a single transaction as well.

#### Request

```
POST /posts
```

```
Content-type: application/json
[
  {"title": "My cat and other marvels", "tags": ["pet", "cute"]},
  {"title": "Pondering during a commute", "tags": ["commuting"]},
  {"title": "Deep meanings in a latte", "tags": ["coffee"]}
]
```

##### curl example
```
$ curl -XPOST -H "Content-type: application/json" -d '[
  {"title": "My cat and other marvels", "tags": ["pet", "cute"]},
  {"title": "Pondering during a commute", "tags": ["commuting"]},
  {"title": "Deep meanings in a latte", "tags": ["coffee"]}
]' 'http://localhost:8080/posts'
```

#### Response

```
Status: 201 - Created
```

```
Content-type: application/json
[
  {
    "id": "219970669169869319",
    "title": "My cat and other marvels",
    "tags": ["pet", "cute"]
  },
  {
    "id": "219970865138237959",
    "title": "Pondering during a commute",
    "tags": ["commuting"]
  },
  {
    "id": "219970873639043587",
    "title": "Deep meanings in a latte",
    "tags": ["coffee"]
  }
]
```

### Retrieve a Post
Retrieves an existent Post for the given Id. If the Post cannot be found, a `404 - Not Found` response is returned.

#### Request

```
GET /post/{post_id}
```

##### curl example
```
$ curl -XGET 'http://localhost:8080/post/219871526709625348'
```

#### Response

```
Status: 200 - OK
```
```
Content-type: application/json
{
  "id": "219871526709625348",
  "title": "My cat and other marvels",
  "tags": ["pet", "cute"]
}
```


### Retrieve Posts
Retrieves all existent Posts.

#### Request

```
GET /posts
```

##### curl example
```
$ curl -XGET 'http://localhost:8080/posts'
```

#### Response

```
Status: 200 - OK
```

```
Content-type: application/json
[
  {
    "id": "219970669169869319",
    "title": "My cat and other marvels",
    "tags": ["pet", "cute"]
  },
  {
    "id": "219970865138237959",
    "title": "Pondering during a commute",
    "tags": ["commuting"]
  },
  {
    "id": "219970873639043587",
    "title": "Deep meanings in a latte",
    "tags": ["coffee"]
  }
]
```

### Retrieve Posts by Title
Retrieves all the existent Posts matching the given Title.

#### Request

```
GET /posts?title={post_title}
```

#### Response

```
Content-type: application/json
[
  {
    "id": "219970669169869319",
    "title": "My cat and other marvels",
    "tags": ["pet", "cute"]
  }
]
```
##### curl example

```
$ curl -XGET 'http://localhost:8080/posts?title=My%20cat%20and%20other%20marvels'
```

### Replace a Post
It replaces an existent Post for the given Id with given fields. All fields should be provided in the representation along the request. If optional fields are not provided they will be set as empty. If the Post cannot be found, a `404 - Not Found` response is returned.

#### Request

```
PUT /post/{post_id}
```

```
Content-type: application/json
{
  "title": "My dog and other marvels"
}
```

##### curl example

```
$ curl -XPUT -H "Content-type: application/json" -d '{
  "title": "My dog and other marvels"
}' 'http://localhost:8080/post/219871526709625348'
```

#### Response

```
Status: 200 - OK
```
```
Content-type: application/json
{
  "id": "219871526709625348"
  "title": "My dog and other marvels",
  "tags": []
}
```

> INFO: note that as the 'tags' field has not been provided in the request, it has been set as empty.


### Delete a Post
Deletes an existent Post for the given Id. If the Post cannot be found, a `404 - Not Found` response is returned.


#### Request

```
DELETE /post/{post_id}
```

##### curl example

```
$ curl -XDELETE 'http://localhost:8080/post/219871526709625348'
```

#### Response

```
Status: 200 - OK
```